@startuml Diagram-01-High-Level-Architecture
!theme plain
title High-Level Architecture Diagram\nSmart Solutions by TripleA

skinparam componentStyle rectangle
skinparam linetype ortho

package "Hardware Layer" {
  component "Raspberry Pi\nZero 2 W" as Pi
  component "HDMI Screen\n(1920x1080)" as Screen
  component "USB Drive\n(Storage)" as USB
}

package "Software Layer" {
  component "Node.js Server" as NodeServer {
    component "Express.js\n(REST API)" as Express
    component "WebSocket Server\n(Real-Time)" as WS
    component "Chokidar\n(File Watcher)" as Chokidar
  }
}

package "Data Source Layer" {
  database "Network Drive\n(Z: Drive)" as NetworkDrive {
    folder "Application Folder\n(UNIFIED-APP)" as AppFolder
    folder "Content Folders\n(Images, Schedules, KPIs)" as Content
  }
}

package "User Interface Layer" {
  component "Client Browser\n(Chrome/Kiosk Mode)" as Browser {
    component "Frontend\n(HTML5/CSS3/JS)" as Frontend
    component "WebSocket Client\n(Real-Time Updates)" as WSClient
  }
}

Pi --> Screen : HDMI
Pi --> USB : USB
Pi --> NodeServer : Runs
Express --> WS : Uses
Chokidar --> WS : Triggers
NetworkDrive --> Chokidar : Monitored
NetworkDrive --> Express : Serves Content
NodeServer --> Browser : HTTP/WebSocket\n(Port 3000)
WS --> WSClient : Real-Time Updates
Express --> Frontend : Serves Files

note right of NetworkDrive
  **Network Drive (Z:)**
  - Application folder
  - Content folders
  - Shared storage
end note

note right of Pi
  **Raspberry Pi Zero 2 W**
  - CPU: Quad-core ARM @ 1GHz
  - RAM: 512MB
  - Network: WiFi/Ethernet
end note

@enduml

@startuml Diagram-02-Software-Stack
!theme plain
title Software Stack Diagram (Layered Architecture)\nSmart Solutions by TripleA

skinparam componentStyle rectangle
skinparam linetype ortho

package "Presentation Layer (Frontend)" {
  component "HTML5" as HTML
  component "CSS3" as CSS
  component "Vanilla JavaScript\n(ES6+)" as JS
  component "WebSocket Client API" as WSClient
  component "Fetch API" as Fetch
}

package "Application Layer (Backend)" {
  component "Express.js\n(REST API)" as Express
  component "WebSocket Server (ws)\n(Real-Time)" as WSServer
  component "Chokidar\n(File Watcher)" as Chokidar
  component "Multer\n(File Uploads)" as Multer
  component "Compression\n(Gzip)" as Compression
  component "Helmet\n(Security Headers)" as Helmet
  component "Express-Rate-Limit\n(API Throttling)" as RateLimit
  component "Express-Session\n(Auth Sessions)" as Session
}

package "Logic Layer" {
  component "Sharp\n(Image Processing)" as Sharp
  component "Canvas\n(Image Analysis)" as Canvas
  component "Tesseract.js\n(OCR)" as Tesseract
  component "bcryptjs\n(Password Hashing)" as Bcrypt
  component "jsonwebtoken\n(JWT Tokens)" as JWT
  component "AI Image Analyzer\n(Color, Duplicates)" as AI
  component "Validator\n(Input Validation)" as Validator
  component "Logger\n(Centralized Logging)" as Logger
  component "Monitoring\n(System Health)" as Monitoring
}

package "Data Layer" {
  database "JSON Storage\n(Flat Files)" as JSON {
    folder "users.json" as UsersJSON
    folder "config.json" as ConfigJSON
    folder "layouts/*.json" as LayoutsJSON
    folder "analytics.json" as AnalyticsJSON
  }
  database "File System\n(Network Drive)" as FileSystem
  database "Image Cache\n(Optimized Images)" as ImageCache
}

HTML --> Express : HTTP Requests
CSS --> Express : Static Files
JS --> Express : API Calls
WSClient --> WSServer : WebSocket
Fetch --> Express : REST API

Express --> Sharp : Image Processing
Express --> Canvas : Image Analysis
Express --> Tesseract : OCR
Express --> Bcrypt : Password Hashing
Express --> JWT : Token Management
Express --> AI : AI Features
Express --> Validator : Input Validation
Express --> Logger : Logging
Express --> Monitoring : Metrics

Sharp --> ImageCache : Save Optimized
Canvas --> ImageCache : Save Analysis
Express --> JSON : Read/Write Config
Express --> FileSystem : Read/Write Files
Express --> ImageCache : Serve Cached

note right of JSON
  **JSON Files:**
  - users.json (User accounts)
  - config.json (40+ settings)
  - layouts/*.json (Custom layouts)
  - analytics.json (Usage data)
end note

note right of Sharp
  **Image Processing:**
  - Resize to 1920x1080
  - Convert to WebP
  - Generate thumbnails
  - Cache optimization
end note

@enduml

@startuml Diagram-03-Sequence-Real-Time-Update
!theme plain
title Sequence Diagram: Real-Time File Update\nSmart Solutions by TripleA

actor User
participant "Network Drive" as NetworkDrive
participant "Chokidar\n(Watcher)" as Chokidar
participant "Node.js\nController" as Controller
participant "Sharp\n(Image Processor)" as Sharp
participant "WebSocket\nServer" as WSServer
participant "Frontend\n(Browser)" as Frontend

User -> NetworkDrive : 1. Add new image file\n(new_product.jpg)
activate NetworkDrive
NetworkDrive -> Chokidar : 2. File system 'add' event
activate Chokidar
Chokidar -> Controller : 3. Notify Node.js Server\n(filePath)
activate Controller
Controller -> Controller : 4. Validate file\nExtract metadata
Controller -> Sharp : 5. Request image optimization\n& thumbnail
activate Sharp
Sharp -> Sharp : 6. Analyze dimensions
Sharp -> Sharp : 7. Resize to 1920x1080\n(if needed)
Sharp -> Sharp : 8. Convert to WebP
Sharp -> Sharp : 9. Generate thumbnail (200x200)
Sharp -> Controller : 10. Return optimized image\n& thumbnail paths
deactivate Sharp
Controller -> WSServer : 11. Prepare update message\n(type: 'FILE_ADDED', data: {...})
activate WSServer
WSServer -> Frontend : 12. Broadcast update message\nto all connected clients
activate Frontend
Frontend -> Frontend : 13. Receive message\nParse JSON
Frontend -> Frontend : 14. Dynamically update DOM\n(Add new image card)
Frontend -> User : 15. New image appears\ninstantly on screen
deactivate Frontend
deactivate WSServer
deactivate Controller
deactivate Chokidar
deactivate NetworkDrive

note over User,NetworkDrive
  **File Addition:**
  User places new image
  in network folder
end note

note over Chokidar,Controller
  **Event Detection:**
  Chokidar detects 'add' event
  instantly (no polling)
end note

note over Sharp
  **Image Optimization:**
  - Resize if > 1080p
  - Convert to WebP
  - Generate thumbnail
  - Save to cache
end note

note over WSServer,Frontend
  **Real-Time Update:**
  WebSocket broadcasts to
  all connected clients
  (~5ms latency)
end note

@enduml

@startuml Diagram-04-Activity-Image-Optimization
!theme plain
title Activity Diagram: Smart Image Optimization\nSmart Solutions by TripleA

start

:Receive Image Request;

:Check File Type;

if (Is Image File?) then (yes)
  :Analyze Dimensions\n(Width x Height);
  :Get Screen Resolution\n(Default: 1920x1080);
  
  if (Image > Screen Resolution?) then (yes)
    :Resize to 1920x1080\n(Maintain aspect ratio);
  else (no)
    :Copy to Cache\n(No resizing needed);
  endif
  
  if (Format is PNG/JPG?) then (yes)
    :Convert to WebP Format\n(Better compression);
  else (no)
    :Keep Original Format;
  endif
  
  :Generate Thumbnail\n(200x200, WebP, Quality 80);
  :Save to Cache\n- Optimized Image\n- Thumbnail;
  :Return Cache Paths\n- /image-cache/...\n- /thumbnails/...;
else (no)
  :Serve Original File\n(Not an image);
endif

stop

note right
  **Performance Metrics:**
  - 4K Image: 8MB → 500KB (94% reduction)
  - 1080p Image: 2MB → 200KB (90% reduction)
  - Processing Time: 100-1000ms
end note

@enduml

@startuml Diagram-05-Security-RBAC
!theme plain
title Security Flowchart (RBAC - Role-Based Access Control)\nSmart Solutions by TripleA

start

:User Attempts Login;

:User Enters\nUsername/Password;

:Validate Input\n- Not Empty\n- Correct Format;

:Find User in\nusers.json;

if (User Found?) then (yes)
  :bcrypt.compare()\nPassword Hash Verification;
  
  if (Password Match?) then (yes)
    :Create Session\n- Set Session ID\n- Store User ID\n- Set Expiry;
    :Generate JWT Token\n- Access Token\n- Refresh Token;
    :Check User Role\nfrom users.json;
    
    if (Role Type?) then (admin)
      :Grant Full Access\n✅ User Management\n✅ System Settings\n✅ Content Management\n✅ All Applications\n✅ Monitoring Dashboard;
    elseif (manager) then
      :Grant Content Access\n✅ Content Management\n✅ Layout Builder\n✅ File Operations\n✅ Assigned Applications\n❌ User Management\n❌ System Settings;
    else (operator)
      :Grant View Access\n✅ View Only Access\n✅ Assigned Applications\n❌ Content Modification\n❌ File Operations\n❌ Settings Access;
    endif
    
    :Set Session Cookie;
    :Return Success\n+ User Data\n+ Tokens;
    stop
  else (no)
    :Return Error\n"Invalid Password";
    stop
  endif
else (no)
  :Return Error\n"Invalid Credentials";
  stop
endif

note right
  **Security Measures:**
  - Password hashing (bcrypt, 10 rounds)
  - HTTP-only cookies
  - JWT token expiration
  - Session expiry (7-30 days)
  - Rate limiting on login
end note

@enduml

@startuml Diagram-06-Data-Schema
!theme plain
title Data Schema Documentation (JSON Structure)\nSmart Solutions by TripleA

package "users.json" {
  class User {
    +id: Number
    +username: String
    +password: String (bcrypt hash)
    +role: String (admin|manager|operator)
    +allowedApps: Array
    +networkPaths: Object
    +lastUsedApp: String
    +preferences: Object
    +createdAt: String (ISO 8601)
    +lastLogin: String (ISO 8601)
  }
}

package "config.json" {
  class ServerConfig {
    +port: Number
    +sessionSecret: String
    +jwtSecret: String
    +sessionMaxAge: Number
    +jwtExpiresIn: String
    +enableCaching: Boolean
  }
  
  class AppConfig {
    +name: String
    +description: String
    +icon: String
    +enabled: Boolean
    +refreshInterval: Number
    +maxImageSize: Number
  }
  
  class ImageProcessingConfig {
    +enabled: Boolean
    +generateThumbnails: Boolean
    +thumbnailQuality: Number
    +optimizeImages: Boolean
    +maxImageDimension: Number
  }
}

package "layouts/*.json" {
  class Layout {
    +id: String
    +name: String
    +description: String
    +createdBy: String
    +createdAt: String
    +updatedAt: String
    +assignedTo: Array
    +widgets: Array<Widget>
    +settings: Object
  }
  
  class Widget {
    +id: String
    +type: String
    +position: Position
    +config: Object
    +style: Object
  }
  
  class Position {
    +x: Number
    +y: Number
    +width: Number
    +height: Number
  }
}

package "analytics.json" {
  class Analytics {
    +pageViews: Array<PageView>
    +fileOperations: Array<FileOperation>
    +searches: Array<Search>
    +userActivity: Array<Activity>
  }
}

User --> AppConfig : allowedApps
User --> ServerConfig : preferences
Layout --> Widget : contains
Layout --> User : assignedTo

note right of User
  **Example:**
  {
    "id": 1,
    "username": "admin",
    "password": "$2a$10$...",
    "role": "admin",
    "allowedApps": ["daily-plan", "gallery", "dashboard"],
    "networkPaths": {
      "main": "Z:\\images",
      "gallery": "Z:\\gallery"
    }
  }
end note

note right of Layout
  **Widget Types:**
  - image-viewer
  - kpi-card
  - slideshow
  - file-browser
  - folder-scanner
  - custom-html
  - text-display
end note

@enduml

@startuml Diagram-07-UI-Sitemap
!theme plain
title UI/UX Sitemap\nSmart Solutions by TripleA

skinparam componentStyle rectangle
skinparam linetype ortho

component "Login Page" as Login {
  [Username Input]
  [Password Input]
  [Login Button]
}

component "Dashboard\n(Main App Selector)" as Dashboard {
  [Daily Plan Card]
  [Gallery Card]
  [Performance Dashboard Card]
  [Admin Panel Card]
}

component "Daily Plan Viewer" as DailyPlan {
  [Morning Schedule\n(06:30-14:29)]
  [Evening Schedule\n(14:30-22:29)]
  [Night Schedule\n(22:30-06:29)]
  [Fullscreen Mode]
}

component "Image Gallery" as Gallery {
  [Browse Mode]
  [Slideshow Mode]
  [Meeting Mode]
  [Image Viewer\n(Zoom, Pan, Filters)]
  [File Management\n(Copy, Move, Delete, Upload)]
  [AI Features\n(OCR, Color, Duplicates)]
}

component "Performance Dashboard" as PerfDashboard {
  [KPI Cards\n(Drag & Drop)]
  [Assign Images/Files]
  [Meeting Mode]
}

component "Admin Panel" as Admin {
  [User Management]
  [System Settings]
  [Layout Builder]
  [Monitoring Dashboard]
  [Backup & Restore]
  [Diagnostics]
}

component "Layout Builder" as LayoutBuilder {
  [Widget Palette]
  [Visual Editor]
  [Save/Load Layouts]
  [Export/Import]
}

component "Global Features" as Global {
  [Global Search (Ctrl+K)]
  [Theme Toggle\n(Dark/Light)]
  [Keyboard Shortcuts]
  [Notifications]
  [PWA Support]
}

Login --> Dashboard : Successful Login
Dashboard --> DailyPlan : Click Card
Dashboard --> Gallery : Click Card
Dashboard --> PerfDashboard : Click Card
Dashboard --> Admin : Click Card (Admin Only)
Admin --> LayoutBuilder : Access
Dashboard --> Global : Available Everywhere
DailyPlan --> Global : Available
Gallery --> Global : Available
PerfDashboard --> Global : Available

note right of Login
  **Authentication:**
  - Session-based
  - JWT tokens
  - Role-based access
end note

note right of Dashboard
  **Main Hub:**
  - App selection
  - Quick access
  - User info
  - Logout
end note

note right of Admin
  **Admin Only:**
  - User management
  - System configuration
  - Monitoring
  - Backups
end note

@enduml

@startuml Diagram-08-Deployment
!theme plain
title Deployment Diagram\nSmart Solutions by TripleA

skinparam componentStyle rectangle
skinparam linetype ortho

package "Network Infrastructure" {
  database "Network Drive (Z:)" as NetworkDrive {
    folder "UNIFIED-APP/" as AppFolder {
      [backend/]
      [frontend/]
      [data/]
      [node_modules/]
      [package.json]
      [START-SERVER.bat]
    }
    folder "Content Folders/" as Content {
      [Images/]
      [Schedules/]
      [KPI/]
    }
  }
}

package "Raspberry Pi Zero 2 W" {
  component "Raspberry Pi OS" as PiOS {
    component "Network Drive Mapping\nZ: → \\\\server\\share\\unified-app" as Mapping
    component "Node.js Runtime\n(v18+)" as NodeJS
    component "Application Server\nExpress.js (Port 3000)" as Server
    component "Startup Script\n(QUICK-START-ALL.bat)" as Startup
  }
}

component "HDMI Screen\n(1920x1080)" as Screen {
  component "Chrome Browser\n(Kiosk Mode)" as Browser {
    component "Application UI\nhttp://localhost:3000" as UI
  }
}

NetworkDrive --> Mapping : Network Mapping\n(SMB/CIFS)
Mapping --> NodeJS : Access Application
NodeJS --> Server : Execute server.js
Startup --> Server : Initialize
Startup --> Browser : Launch Kiosk Mode
Server --> Browser : HTTP/WebSocket\n(Port 3000)
Browser --> Screen : Display
PiOS --> Screen : HDMI Connection

note right of NetworkDrive
  **Network Drive Structure:**
  - Application folder
  - Content folders
  - Shared storage
  - Centralized deployment
end note

note right of PiOS
  **Raspberry Pi Setup:**
  1. Install Raspberry Pi OS
  2. Install Node.js (v18+)
  3. Map network drive
  4. Run npm install
  5. Configure auto-start
end note

note right of Browser
  **Kiosk Mode:**
  - Fullscreen
  - No address bar
  - Auto-start on boot
  - Touch-optimized
end note

@enduml

@startuml Diagram-09-Code-Snippets
!theme plain
title Code Snippets (Key Algorithms)\nSmart Solutions by TripleA

package "1. Chokidar Watcher Configuration" {
  class ChokidarWatcher {
    +setupDailyPlanWatcher(path, wss)
    +persistent: true
    +ignoreInitial: true
    +awaitWriteFinish: {stabilityThreshold: 1000}
    +usePolling: false
    +depth: 1
    +ignorePermissionErrors: true
    --
    +on('add', handler)
    +on('change', handler)
    +on('unlink', handler)
  }
}

package "2. Sharp Image Resizing" {
  class ImageProcessor {
    +optimizeImage(inputPath, maxDimension, quality)
    +generateThumbnail(inputPath, size)
    +getCachedImage(imagePath)
    +generateCacheKey(imagePath, dimensions, mtime)
    --
    -Resize if > maxDimension
    -Convert to WebP
    -Maintain aspect ratio
    -Cache management
  }
}

package "3. WebSocket Broadcast" {
  class WebSocketBroadcast {
    +broadcastToDailyPlan(wss, message)
    +broadcastToGallery(wss, message)
    +broadcastToDashboard(wss, message)
    --
    -Check readyState === OPEN
    -Filter by appType
    -Error handling
    -Monitoring integration
  }
}

package "4. Authentication Middleware" {
  class AuthMiddleware {
    +requireAuth(req, res, next)
    +requireRole(roles)
    +hashPassword(password)
    +verifyPassword(password, hash)
    --
    -Session check
    -JWT token verification
    -Role-based access
    -bcrypt hashing
  }
}

package "5. Rate Limiting" {
  class RateLimiter {
    +rateLimit(maxRequests, windowMs)
    +cleanupExpired()
    --
    -IP-based tracking
    -Sliding window
    -Automatic cleanup
    -Different limits per endpoint
  }
}

ChokidarWatcher --> WebSocketBroadcast : Triggers
ImageProcessor --> WebSocketBroadcast : Provides Data
AuthMiddleware --> WebSocketBroadcast : Validates Access
RateLimiter --> AuthMiddleware : Protects Endpoints

note right of ChokidarWatcher
  **Key Features:**
  - Event-driven (no polling)
  - Stability threshold
  - Performance optimized
  - Network drive support
end note

note right of ImageProcessor
  **Optimization:**
  - Resize to 1920x1080
  - Convert to WebP
  - Generate thumbnails
  - Cache management
  - 94% size reduction
end note

note right of WebSocketBroadcast
  **Features:**
  - Connection validation
  - App-type filtering
  - Error handling
  - Monitoring integration
  - ~5ms latency
end note

@enduml

